<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title></title>
  <link href="assets/css/vis.min.css" rel="stylesheet" text="text/css" />
  <link href="assets/css/vis.css" rel="stylesheet" text="text/css" />
  <link href="assets/css/index.css" rel="stylesheet" text="text/css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="assets/js/vis.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/taffydb/2.7.3/taffy.js"></script>
</head>


<body>

  <form id="myForm" class="demo" method="POST" action="/files" onsubmit="event.preventDefault(); return loadData(this)" ;>

    <div class="tooltip">
      <input type="text" name="caseNumber" id="caseNumber" placeholder="Case #: " />
      <span class="tooltiptext">The unique case #</span>
    </div>

    <div class="tooltip">
      <input type="text" name="agencyName" id="agencyName" placeholder="Submitting Agency: " />
      <span class="tooltiptext">Who is submitting this?</span>
    </div>

    <div class="tooltip">
      <input type="text" name="agencyAddress" id="agencyAddress" placeholder="Submitting Agency's Address: " />
      <span class="tooltiptext">Where are they located?</span>
    </div>


    <div class="tooltip">
      <input type="text" name="collectedBy" id="collectedBy" placeholder="Collected By: " />
      <span class="tooltiptext">Who is submitting this?</span>
    </div>

    <div class="tooltip">
      <input type="text" name="itemDescription" id="itemDescription" placeholder="Description of evidence: " />
      <span class="tooltiptext">What is it?</span>
    </div>

    <div class="tooltip">
      <input type="text" id="locationFound" placeholder="Location of Evidence: " />
      <span class="tooltiptext">Where was it found?</span>
    </div>

    <div class="tooltip">
      <input type="text" name="natureOfCase" id="natureOfCase" placeholder="Nature of Case: " />
      <span class="tooltiptext">- Which Sector: Public/Private <br />- Which Case: Criminal/Civil</span>
    </div>

    <div class="tooltip">
      <input type="text" name="contact" id="contact" placeholder="Phone #: (555) 555-5555" />
      <span class="tooltiptext">How can we reach you?</span>
    </div>

    <div class="tooltip">
      <input class="extraSpace" type="datetime-local" name="timeRemoved" id="timeRemoved" /> <br />
      <span class="tooltiptext">When did you remove it?</span>
    </div>

    <div class="tooltip">
      <input class="extraSpace" type="datetime-local" name="timeReturned" id="timeReturned" /> <br />
      <span class="tooltiptext">When did you put it back?</span>
    </div>



    <script>
      function confirmDelete() {
        var x = confirm("Warning: This will delete all table and timeline data permanently.");
        if (x)
          return true;
        else
          Event.stop(event);
          return false;
      }
    </script>

    <div id="space">
      <div class="tooltip">
        <input class="space" onclick="submitForm()" id="loadStuff" type="button" value="Load" /><br />
        <span class="tooltiptext">Load to table</span>
      </div>
      <div class="tooltip">
        <input type="button" value="Populate" onclick="window.location.reload()" />
        <span class="tooltiptext">Populate the timeline</span>
      </div>
      <div class="tooltip">
        <input type="button" value="Save" id="save"/>
        <span class="tooltiptext">Save table to .xls file</span>
      </div>
      <div class="tooltip">
        <input type="button" value="Reset" onclick="confirmDelete(); clearStorage();" />
        <span class="tooltiptext">Clear table and timeline</span>
      </div>

    </div>
  </form>




  <div id='box'>

  </div>

  <div id='result'>
    <table id="myTable" border="1">
      <thead>History of Timeline:</thead>
      <th> Case #: </th>
      <th> Agency Name:  </th>
      <th> Agency Address:  </th>
      <th> Collected By: </th>
      <th> Item Description: </th>
      <th> Location Found: </th>
      <th> Case Nature: </th>
      <th> Contact: </th>
      <th> Removed: </th>
      <th> Returned: </th>


      <tbody id="tableBody">
      </tbody>
    </table>
  </div>


  <div id="visualization"></div>
</body>

<script type="text/javascript" src="assets/js/timeline.js"></script>
<script type="text/javascript" src="assets/js/script.js"></script>
<script>
  var table = document.getElementById("tableBody");
  toDoArray = [];

  window.addTaskToTable = function addTaskToTable(obj) {
    var row = table.insertRow(0);
    var cellCaseNumber = row.insertCell(0);
    var cellAgencyName = row.insertCell(1);
    var cellAgencyAddress = row.insertCell(2);
    var cellCollectedBy = row.insertCell(3);
    var cellItemDescription = row.insertCell(4);
    var cellLocationFound = row.insertCell(5);
    var cellNatureOfCase = row.insertCell(6);
    var cellContact = row.insertCell(7);
    var cellTimeRemoved = row.insertCell(8);
    var cellTimeReturned = row.insertCell(9);


    cellCaseNumber.innerHTML = obj.caseNumber;
    cellAgencyName.innerHTML = obj.agencyName;
    cellAgencyAddress.innerHTML = obj.agencyAddress;
    cellCollectedBy.innerHTML = obj.collectedBy;
    cellItemDescription.innerHTML = obj.itemDescription;
    cellLocationFound.innerHTML = obj.locationFound;
    cellNatureOfCase.innerHTML = obj.natureOfCase;
    cellContact.innerHTML = obj.contact;
    cellTimeRemoved.innerHTML = obj.timeRemoved;
    cellTimeReturned.innerHTML = obj.timeReturned;


    addToStorage();
  }

  window.submitForm = function submitForm() {
    var caseNumber = document.getElementById("caseNumber").value;
    var agencyName = document.getElementById("agencyName").value;
    var agencyAddress = document.getElementById("agencyAddress").value;
    var collectedBy = document.getElementById("collectedBy").value;
    var itemDescription = document.getElementById("itemDescription").value;
    var locationFound = document.getElementById("locationFound").value;
    var natureOfCase = document.getElementById("natureOfCase").value;
    var contact = document.getElementById("contact").value;
    var timeRemoved = document.getElementById("timeRemoved").value;
    var timeReturned = document.getElementById("timeReturned").value;
    var taskSomething = getTaskObj(caseNumber, agencyName, agencyAddress, collectedBy, itemDescription, locationFound, natureOfCase, contact, timeRemoved, timeReturned);
    toDoArray.push(taskSomething);
    addTaskToTable(taskSomething);
  };

  window.getTaskObj = function getTaskObj(caseNumber, agencyName, agencyAddress, collectedBy, itemDescription, locationFound, natureOfCase, contact, timeRemoved, timeReturned) {
    var taskObject = {
      caseNumber: caseNumber,
      agencyName: agencyName,
      agencyAddress: agencyAddress,
      collectedBy: collectedBy,
      itemDescription: itemDescription,
      locationFound: locationFound,
      natureOfCase: natureOfCase,
      contact: contact,
      timeRemoved: timeRemoved,
      timeReturned: timeReturned

    };
    return taskObject;
    console.log(taskObject);
  }

  window.addToStorage = function addToStorage() {
    var storedArray = JSON.stringify(toDoArray);
    localStorage.setItem("task", storedArray);

    <!--TRY ONE-->
    /* This method loads into whatever file is specified --> .xls, .doc, or .json in a beautified format:

    var forensics = TAFFY();

    forensics.insert(storedArray);


    var str = JSON.stringify(forensics().get(), null, "\t");

    function download(text, name, type) {
      var a = document.createElement("a");
      var file = new Blob([text], {
        type: type
      });
      a.href = URL.createObjectURL(file);
      a.download = name;
      a.click();
    }
    download(str, 'test.json', 'text/plain');

    */

    <!--TRY TWO-->

    var app = {};
    /**
     * Method to convert to csv from json
     **/
    app.JSON2CSV = function(objArray, addLabel, addQuote) {
      var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;
      var str = '';
      var line = '';
      /*
      $("#quote").is(':checked')
      $("#labels").is(':checked')
      */

      if (addLabel) {
        var head = array[0];
        var outputTitles = ["Case Number", "Agency Name", "Agency Address", "Collected By", "Description", "Location Found", "Nature Of Case", "Contact", "Removed", "Returned"];
        var length = outputTitles.length;
        var stringy = outputTitles + ":";
        var count = 0;
        for (var j=0; j<1; j++) {
          line += stringy;
          count++;

          if(count > 1){
            break;
          }
        }

          line = line.slice(0, -1);
          str += line + '\r\n';

      }

      for (var i = 0; i < array.length; i++) {
        line = '';
        for (var index3 in array[i]) {
          var value2 = array[i][index3] + "";
          if (addQuote) {
            line += '"' + value2.replace(/"/g, '""') + '",';
          } else {
            line += value2 + ',';
          }
        }
        line = line.slice(0, -1);
        str += line + '\r\n';
      }
      return str;
    };
    /**
     * Method to download CSV form JSON object.
     **/
    app.downloadCSV = function(json, addLabel, addQuote) {
      var csv = app.JSON2CSV(json, addLabel, addQuote);
      var downloadLink = document.createElement("a");
      var blob = new Blob(["\ufeff", csv]);
      var url = URL.createObjectURL(blob);
      downloadLink.href = url;
      downloadLink.download = "timeline.csv";

      document.body.appendChild(downloadLink);
      downloadLink.click();
      document.body.removeChild(downloadLink);
    };
    $("#save").click(function() {
      var json = TAFFY();
      json.insert(storedArray);
      var ugh = JSON.stringify(json().get(), null, "\t");
      console.log(json);

      app.downloadCSV(ugh, true, true);
    });

  }

  window.buildTable = function buildTable(parsedObject) {

    if (parsedObject != null) {
      for (i = 0; i < parsedObject.length; i++) {
        toDoArray.push(getTaskObj(parsedObject[i].caseNumber, parsedObject[i].agencyName, parsedObject[i].agencyAddress, parsedObject[i].collectedBy, parsedObject[i].itemDescription, parsedObject[i].locationFound, parsedObject[i].natureOfCase, parsedObject[i].contact, parsedObject[i].timeRemoved, parsedObject[i].timeReturned));
        addTaskToTable(parsedObject[i]);
      }
    }


  }


  function loadInitData() {
    var retrievedTaskObject = localStorage.getItem("task");
    var parsedObject = JSON.parse(retrievedTaskObject);
    buildTable(parsedObject);
    loadInitialTimelineData(parsedObject);
  }




  function loadInitialTimelineData(parsedObject) {
    var data = [];
    if (parsedObject != null) {
      for (i = 0; i < parsedObject.length; i++) {
        data.push({
          "id": parsedObject[i].caseNumber,
          "content": "Date: " + parsedObject[i].timeRemoved + "<br />" + "Case #: " + parsedObject[i].caseNumber,
          "className": "green",
          "start": parsedObject[i].timeRemoved,
          "end": parsedObject[i].timeReturned,
          "title": "Agency: SOMETITLE"
        })
      }
    }

    items.clear();
    items.add(data);
    timeline.fit();



  }

  /*
  Functionality function for reset button
   */
  function clearStorage() {
    localStorage.clear();
  }

  loadInitData()


</script>

<script>
</script>



</html>
