<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title></title>
  <link href="assets/css/vis.min.css" rel="stylesheet" text="text/css" />
  <link href="assets/css/vis.css" rel="stylesheet" text="text/css" />
  <link href="assets/css/index.css" rel="stylesheet" text="text/css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="assets/js/vis.min.js"></script>

</head>

<body>

  <form id="myForm" class="demo" method="POST" action="/files" onsubmit="event.preventDefault(); return loadData(this)" ;>


    <input type="text" name="agencyName" id="agencyName" placeholder="Agency Name: " />
    <input type="text" name="agencyAddress" id="agencyAddress" placeholder="Agency Address: " />
    <!---->

    <input type="text" name="caseNumber" id="caseNumber" placeholder="Case #: " />
    <input type="text" name="investigatingOrganization" id="investigatingOrganization" placeholder="Investigating Organization: "
    />
    <input type="text" name="investigator" id="investigator" placeholder="Investigator: " />
    <input type="text" name="natureOfCase" id="natureOfCase" placeholder="Nature of Case: " />
    <input type="text" id="locationOfEvidence" placeholder="Location of Evidence: " />
    <!---->

    <input type="text" name="itemDescription" id="itemDescription" placeholder="Description of evidence: " />
    <!---->

    <input type="text" name="recoveredBy" id="recoveredBy" placeholder="Recovered by: " />

    <div class="moveOver">
      Time in: <br />
      <input class="extraSpace" type="datetime-local" name="timeRemoved" id="timeRemoved" /> <br />
      Time out: <br />
      <input class="extraSpace" type="datetime-local" name="timeReturned" id="timeReturned" /> <br />
    </div>

    <div id="space">
      <input onclick="submitForm()" id="loadStuff" type="button" value="Load" /><br />
      <input type="button" value="Populate" onClick="window.location.reload()"><br />
      <button onclick="clearStorage()">Reset</button>
    </div>
  </form>

  <div id='box'>

  </div>

  <div id='result'>
    <table id="myTable" border="1">
      <thead>History of Timeline:</thead>
      <th> Case # </th>
      <th> Investigator </th>
      <th> Time In </th>
      <th> Time Out </th>
      <th> Item Description </th>
      <tbody id="tableBody"></tbody>
    </table>
  </div>


  <div id="visualization"></div>
</body>

<script type="text/javascript" src="assets/js/timeline.js"></script>
<script type="text/javascript" src="assets/js/script.js"></script>
<script>
  var table = document.getElementById("tableBody");
  toDoArray = [];

  window.addTaskToTable = function addTaskToTable(obj) {
    var row = table.insertRow(0);
    var cellCaseNumber = row.insertCell(0);
    var cellInvestigator = row.insertCell(1);
    var cellTimeRemoved = row.insertCell(2);
    var cellTimeReturned = row.insertCell(3);
    var cellItemDescription = row.insertCell(4);
    cellCaseNumber.innerHTML = obj.caseNumber;
    cellInvestigator.innerHTML = obj.investigator;
    cellTimeRemoved.innerHTML = obj.timeRemoved;
    cellTimeReturned.innerHTML = obj.timeReturned;
    cellItemDescription.innerHTML = obj.itemDescription;
    addToStorage();
  }

  window.submitForm = function submitForm() {
    var caseNumber = document.getElementById("caseNumber").value;
    var investigator = document.getElementById("investigator").value;
    var timeRemoved = document.getElementById("timeRemoved").value;
    var timeReturned = document.getElementById("timeReturned").value;
    var itemDescription = document.getElementById("itemDescription").value;
    var taskSomething = getTaskObj(caseNumber, investigator, timeRemoved, timeReturned, itemDescription);
    toDoArray.push(taskSomething);
    addTaskToTable(taskSomething);
  };

  window.getTaskObj = function getTaskObj(caseNumber, investigator, timeRemoved, timeReturned, itemDescription) {
    var taskObject = {
      caseNumber: caseNumber,
      investigator: investigator,
      timeRemoved: timeRemoved,
      timeReturned: timeReturned,
      itemDescription: itemDescription
    };
    return taskObject;
  }

  window.addToStorage = function addToStorage() {
    var storedArray = JSON.stringify(toDoArray);
    localStorage.setItem("task", storedArray);
  }

  window.buildTable = function buildTable(parsedObject) {

    if (parsedObject != null) {
      for (i = 0; i < parsedObject.length; i++) {
        toDoArray.push(getTaskObj(parsedObject[i].caseNumber, parsedObject[i].investigator, parsedObject[i].timeRemoved, parsedObject[i].timeReturned, parsedObject[i].itemDescription));
        addTaskToTable(parsedObject[i]);
      }
    }
  }


  function loadInitData() {
    var retrievedTaskObject = localStorage.getItem("task");
    var parsedObject = JSON.parse(retrievedTaskObject);
    buildTable(parsedObject);
    loadInitialTimelineData(parsedObject);
  }

  function loadInitialTimelineData(parsedObject) {
    var data = [];
    console.log( parsedObject);
    if (parsedObject != null) {
      for (i = 0; i < parsedObject.length; i++) {
        data.push(
          {
            "id": parsedObject[i].caseNumber,
            "content": "Date: " + parsedObject[i].timeRemoved + "<br />" + "Case #: " + parsedObject[i].caseNumber,
            "className": "green",
            "start": parsedObject[i].timeRemoved,
            "end": parsedObject[i].timeReturned,
            "title": "Agency: SOMETITLE"
          }
        )
      }
    }

    items.clear();
    items.add(data);
    timeline.fit();
  }

  /*
  Functionality function for reset button
   */
  function clearStorage() {
    localStorage.clear();
  }

  loadInitData()
</script>

</html>
